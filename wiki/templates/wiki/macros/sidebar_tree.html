{% macro render_wiki_tree(nodes, level=0, current_route='') %}
    {% if nodes %}
        <ul class="wiki-tree list-none m-0 px-0 py-0.5 space-y-0.5">
            {% for node in nodes %}
                <li class="wiki-item {{ 'is-group' if node.is_group else 'is-page' }}">
                    {% if node.is_group %}
                        {# Group/folder item #}
                        <button class="wiki-item-content group w-full flex items-center h-7 rounded px-2 text-[var(--ink-gray-7)] transition-all duration-200 cursor-pointer hover:bg-[var(--surface-gray-2)]"
                                @click="toggleNode('{{ node.name }}')"
                                :aria-expanded="isExpanded('{{ node.name }}')"
                                aria-controls="{{ node.name }}-children"
                                title="{{ node.title }}"
                                data-route="{{ node.route }}"
                                data-node-id="{{ node.name }}">
                            {# Triangle chevron that rotates 90Â° when expanded #}
                            <svg class="w-3 h-3 mr-1.5 text-[var(--ink-gray-4)] transition-transform duration-200 flex-shrink-0"
                                 :class="isExpanded('{{ node.name }}') ? 'rotate-90' : 'rotate-0'"
                                 viewBox="0 0 12 12" fill="currentColor">
                                <path d="M4 8.54V3.46c0-.4.455-.64.787-.41l3.628 2.54a.5.5 0 010 .82L4.787 8.95A.5.5 0 014 8.54z"/>
                            </svg>
                            <span class="wiki-title text-sm font-medium truncate">{{ node.title }}</span>
                        </button>
                    {% else %}
                        {# Page/leaf item #}
                        <a href="/{{ node.route }}"
                           @click.prevent="$store.navigation.navigateTo('{{ node.route }}')"
                           @mouseenter="$store.navigation.prefetch('{{ node.route }}')"
                           class="wiki-item-content wiki-link group flex items-center h-7 rounded px-2 text-[var(--ink-gray-7)] no-underline transition-all duration-200"
                           :class="$store.navigation.currentRoute === '{{ node.route }}' ? 'bg-[var(--surface-selected)] shadow-sm text-[var(--ink-gray-9)]' : 'hover:bg-[var(--surface-gray-2)]'"
                           :aria-current="$store.navigation.currentRoute === '{{ node.route }}' ? 'page' : false"
                           title="{{ node.title }}"
                           data-route="{{ node.route }}"
                           data-node-id="{{ node.name }}">
                            <span class="wiki-title text-sm truncate {{ 'pl-[18px]' if level == 0 else '' }}">{{ node.title }}</span>
                        </a>
                    {% endif %}

                    {% if node.children %}
                        <div id="{{ node.name }}-children"
                             class="wiki-children overflow-hidden pl-4 mt-0.5"
                             x-show="isExpanded('{{ node.name }}')"
                             x-collapse>
                            {{ render_wiki_tree(node.children, level + 1, current_route) }}
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}
